function NS(n,t,i){if(n=n.split("."),n.isArray()&&!n.length)return 0;var r=this;return n.forEach(function(n){r[n]=r[n]||{};r=r[n]}),i&&(r[t]=i),r[t]}function NS(n,t,i,r=globalThis){if(n=n.split(".").filter(Boolean),!n.length)return null;var u=r;return n.forEach(function(n){u[n]=u[n]||{};u=u[n]}),i&&(u[t]=i),u[t]}Object.prototype.assigns||Object.defineProperty(Object.prototype,"assigns",{enumerable:!1,value:function(n){"use strict";var r,u,i,t;if(n==null)throw new TypeError("Cannot convert undefined or null to object");for(r=Object.create(n),u=1;u<arguments.length;u++)if(i=arguments[u],i!=null)for(t in i)Object.prototype.hasOwnProperty.call(i,t)&&(r[t]=typeof r[t]=="object"&&r[t]&&typeof i[t]=="object"&&i[t]?Object.assigns({},r[t],i[t]):i[t]);return r}});Object.prototype.length||Object.defineProperty(Object.prototype,"length",{enumerable:!1,value:function(){return Object.keys(this).length}});Object.prototype.forEach||Object.defineProperty(Object.prototype,"forEach",{enumerable:!1,configurable:!0,value:function(n,t){for(prop in this)n.call(t,this[prop],prop,this)}});Object.prototype.sortKey||Object.defineProperty(Object.prototype,"sortKey",{enumerable:!1,value:function(){return Object.keys(this).sort(function(n,t){return this[n]-this[t]})}});Object.prototype.is||Object.defineProperty(Object.prototype,"is",{enumerable:!1,configurable:!0,value:function(n,t,i){n=n.isFunction()?n.call(this):n;t=t!=undefined?t:!0;i=i!=undefined?i:!1;switch(this.getType()){case"object":for(var r in this)if(this.hasOwnProperty(r))return i;return t;default:return this==n?t:i}}});Object.prototype.isEmpty||Object.defineProperty(Object.prototype,"isEmpty",{enumerable:!1,value:function(){return this.is.call(this,function(){switch(this.getType()){case"object":return this;case"number":return 0;case"string":return"";case"function":return this();case"array":return this.length;default:return undefined}},!0,!1)}});Object.prototype.isEmptyToDefault||Object.defineProperty(Object.prototype,"isEmptyToDefault",{enumerable:!1,value:function(n,t){switch(this.getType()){case"object":if(this.isEmpty())return n;if(this.hasOwnProperty(t))return this[t];break;default:return this.isEmpty()?n:this.valueOf()}}});Number.prototype.isNull||(Number.prototype.isNull=function(){return this.is(null,!0,!1)});Object.prototype.getType||Object.defineProperty(Object.prototype,"getType",{enumerable:!1,value:function(){return this.constructor.name.toLowerCase()}});Object.prototype.isType||Object.defineProperty(Object.prototype,"isType",{enumerable:!1,value:function(n){return this.getType()==n}});Object.prototype.isArray||Object.defineProperty(Object.prototype,"isArray",{enumerable:!1,value:function(){return Array.isArray(this)}});Object.prototype.isBoolean||Object.defineProperty(Object.prototype,"isBoolean",{enumerable:!1,value:function(){return this.getType()=="boolean"}});Object.prototype.isFile||Object.defineProperty(Object.prototype,"isFile",{enumerable:!1,value:function(){return this.getType()=="file"}});Object.prototype.isString||Object.defineProperty(Object.prototype,"isString",{enumerable:!1,value:function(){return this.getType()=="string"}});Object.prototype.isNumber||Object.defineProperty(Object.prototype,"isNumber",{enumerable:!1,value:function(){return this.getType()=="number"}});Object.prototype.isObject||Object.defineProperty(Object.prototype,"isObject",{enumerable:!1,value:function(){return this.getType()=="object"}});Object.prototype.isFunction||Object.defineProperty(Object.prototype,"isFunction",{enumerable:!1,value:function(){return this.getType()=="function"}});Object.prototype.defineProperties||Object.defineProperty(Object.prototype,"defineProperties",{enumerable:!1,value:function(){var n=this,t=Array.prototype.slice.call(arguments);t.forEach(function(t){var i;Object.defineProperty(n,t,{enumerable:!1,get:function(){return i},set:function(n){i=n}})})}});Object.prototype.defineMethods||Object.defineProperty(Object.prototype,"defineMethods",{enumerable:!1,value:function(n,t,i,r){r=r==undefined?!0:r;i=i?i:this;for(method in n)r&&i[method]!=undefined||Object.defineProperty(i,method,{enumerable:t?!0:!1,value:n[method]})}});Object.prototype.defineData||Object.defineProperty(Object.prototype,"defineData",{enumerable:!1,value:function(n,t,i,r){for(key in n)Object.defineProperty(i?i:this,key,{enumerable:t?!0:!1,writable:r?!0:!1,value:n[key]})}});Object.prototype.extend||Object.defineProperty(Object.prototype,"extend",{enumerable:!1,value:function(n,t){(function(){var r,i,u;if(n.prototype&&n.prototype.isEmpty())n.prototype=t?Object.create(t.prototype):Object.create(null);else{r=function(){};r.prototype=n.prototype;n.prototype=Object.create(t.prototype);n.prototype.constructor=n;for(i in r.prototype)n.prototype.hasOwnProperty(i)||(u=undefined,n.prototype[i]&&typeof n.prototype[i]=="object"&&(u=Object.assigns({},n.prototype[i],r.prototype[i])),Object.defineProperty(n.prototype,i,{enumerable:!0,writable:!0,value:u?u:r.prototype[i]}))}})();Object.defineProperty(n.prototype,"super",{enumerable:!0,value:t.prototype});n.prototype.constructor=n}});Object.prototype.extendMany||Object.defineProperty(Object.prototype,"extendMany",{enumerable:!1,value:function(){var t=Array.prototype.slice.call(arguments),n=undefined;t.reverse().forEach(function(t){n?(t.extendFrom(n),n=t):n=t})}});Object.prototype.extendFrom||Object.defineProperty(Object.prototype,"extendFrom",{enumerable:!1,value:function(n){this.extend(this,n)}});Object.prototype.extendFroms||Object.defineProperty(Object.prototype,"extendFroms",{enumerable:!1,value:function(){var t=Array.prototype.slice.call(arguments),n=undefined;t.reverse().forEach(function(t){if(t)if(n){var i=t.clone();i.extendFrom(n);n=i}else n=t.clone()});n&&this.extend(this,n)}});Function.prototype.clone||Object.defineProperty(Function.prototype,"clone",{enumerable:!1,value:function(){function n(){return t.apply(this,arguments)}var t=this,i;return this._isClone&&(i=this.master),n.prototype=this.prototype,n._isClone=!0,n._master=t,n}});Object.prototype.generatePreference||Object.defineProperty(Object.prototype,"generatePreference",{enumerable:!1,value:function(){var n=document.getElementsByTagName("body"),i=n[0]&&n[0].getAttribute("preference")?n[0].getAttribute("preference"):!1,t;return i?(t="-{0}".format(i),this.forEach(function(n,i,r){i.search(t)>0&&(r[i.replace(t,"")]=n)}),this):0}});Object.prototype.toFormData||Object.defineProperty(Object.prototype,"toFormData",{enumerable:!1,value:function(){var n=new FormData;return this.forEach(function(t,i){typeof t=="object"?n.append(i,JSON.stringify(t)):n.append(i,t)}),n}});var App=App||{};const NAMESPACE="App.Class.Module",NAMECLASS="Main",INSTANCE="Viewer";NS(NAMESPACE,NAMECLASS,(()=>{function w(n){const t=()=>Date.now();return{set:function(i,r,u=0){const f={value:r,expiresAt:u?t()+u:null,savedAt:t(),v:1};localStorage.setItem(n+i,JSON.stringify(f))},get:function(i){const r=localStorage.getItem(n+i);if(!r)return null;try{const u=JSON.parse(r);return u.expiresAt&&t()>u.expiresAt?(localStorage.removeItem(n+i),null):u.value}catch(u){return localStorage.removeItem(n+i),null}},remove:function(t){localStorage.removeItem(n+t)},sweep:function(){for(let i=0;i<localStorage.length;i++){const r=localStorage.key(i);if(r&&r.startsWith(n))try{const n=JSON.parse(localStorage.getItem(r));n&&n.expiresAt&&t()>n.expiresAt&&localStorage.removeItem(r)}catch(u){localStorage.removeItem(r)}}}}}function c(){let n=this;n.init().render().reset().resetAll()}var u;const o="https://script.google.com/macros/s/AKfycbyVtPa9o1sbeRkbBjiU4HNP98h9RvO8nsDRouD8l87Qz851en8isAlxSiyv7NvwwiHGBA/exec?channel=web",l=0,v="c",f="app.parkqr:",s="pref-lang",e="passkey",y=72e5,h=12e3,a={weekday:"long",year:"numeric",month:"short",day:"numeric"},p={year:"numeric",month:"short",day:"numeric"},n={get_text:i=>{let r=n[t]||n["th-TH"],f=i.split("."),u;return f.forEach(function(n){if(!r[n])return 0;if(r[n].isObject())return r=r[n],0;u=r[n]}),u},"en-EN":{title:"ParkQR Viewer - METROLUXE Kaset Condominium",version:"ParkQR Viewer (version 2.0)",header01:"Parking Permit Holder Information",header02:"New registration",header03:"Owner information","header-vehicle01":"Vehicle #1","header-vehicle02":"Vehicle #2","permit-qr":"QR Code","label-no":"Sticker No.","label-type":"Sticker type","owner-zone":"Parking zone","owner-unit":"Unit no.","owner-name":"Owner’s name","owner-phone":"Phone number","datetime-regist":"Regist. date","date-expire":"Expiry date","vehicle-type":"Vehicle type","lp-no":"License plate no.","lp-province":"Registered province","btn-detail":"View more information","btn-regist":"Register",option:"-- Please select -- ","option-province":"-- Please select province -- ",caution:"If you need to update or change parking permit information,<br>please contact the juristic person office.",disclaimer:"METROLUXE Kaset Condominium<br>Juristic Person Office<br>39 Phahonyothin, Sena Nikhom Subdistrict,<br>Chatuchak District, Bangkok 10900",notice:"The parking sticker is the property of the condominium juristic person.It is issued solely for the purpose of identifying authorized users in accordance with the condominium’s regulations. The holder does not possess ownership rights over the sticker. Transfer, sale, or use for any other purpose is strictly prohibited.The juristic person reserves the right to revoke or withdraw the sticker immediately in the event that the holder’s rights are terminated or any regulations are violated.",lost:{text:"This sticker has been reported lost.<br>Possession or use is prohibited.<br>Please return it to the Juristic Person Office immediately.","label-no":"Sticker no. : ","date-lost":"Lost date : "},message:{"data-operate":{ing:"<h1>... Retriving ...<\/h1>",access:"<h1>... Accessing ...<\/h1>",error:"... An error occurred ...","not-allow":"... unautherize/wrong passkey ...",regist:"... Registrating, please wait ...","regist-cmp":"... Registration complete ..."},"not-found":"Information from QR-Code is not found.<br />Please try again.",password:"Please enter the user's password."},"option-value":{"vehicle-type":{CAR:"Car",BIKE:"Motorbike"},"owner-zone":{BLD_A:"Building A",BLD_B:"Building B",BLD_C:"Building C"}}},"th-TH":{title:"ParkQR Viewer - อาคารชุดเมโทรสักซ์-เกษตร",version:"ParkQR Viewer (เวอร์ชัน 2.0)",header01:"ข้อมูลผู้ใช้สิทธิ์จอดยานพาหนะ",header02:"ลงทะเบียนสติกเกอร์ใหม่",header03:"ข้อมูลเจ้าของร่วม/ผู้เช่า/ผู้ใช้สิทธิ์","header-vehicle01":"ยานพาหนะ #1","header-vehicle02":"ยานพาหนะ #2","permit-qr":"รหัสคิวอาร์","label-no":"ลำดับสติกเกอร์","label-type":"ประเภทสติกเกอร์","owner-zone":"อาคาร/โซนจอด","owner-unit":"เลขที่ห้องชุด","owner-name":"ชื่อเจ้าของร่วม","owner-phone":"หมายเลขโทรศัพท์","datetime-regist":"วันที่ลงทะเบียน","date-expire":"วันหมดอายุ","vehicle-type":"ประเภทยานพาหนะ","lp-no":"เลขทะเบียน","lp-province":"จังหวัดจดทะเบียน","btn-detail":"รายละเอียดผู้ใช้สิทธิ์ฯเพิ่มเติม","btn-regist":"ลงทะเบียนสติกเกอร์",option:"-- โปรดระบุ -- ","option-province":"-- โปรดระบุจังหวัด -- ",caution:"ต้องการแก้ไข/เปลี่ยนแปลง <br>ข้อมูลผู้รับสิทธิ์ ข้อมูลยานพาหนะ<br>กรุณาติดต่อสำนักงานนิติบุคคล<br>ในวันและเวลาทำการ",disclaimer:"นิติบุคคลอาคารชุดเมโทรลักซ์-เกษตร<br>39 ถนนประเสริฐมนูกิจ แขวงเสนานิคม เขตจตุจักร<br>กรุงเทพมหานคร 10900",notice:"สติกเกอร์จอดรถเป็นทรัพย์สินของนิติบุคคลอาคารชุด ใช้เพื่อระบุตัวตนของผู้ได้รับสิทธิตามระเบียบนิติบุคคลเท่านั้น ผู้ครอบครองไม่มีสิทธิเป็นเจ้าของ ห้ามโอน ขาย หรือใช้ในวัตถุประสงค์อื่น นิติบุคคลขอสงวนสิทธิเรียกคืนหรือเพิกถอนการใช้ได้ทันที หากผู้ครอบครองสิ้นสิทธิหรือฝ่าฝืนข้อกำหนด",lost:{text:"สติกเกอร์นี้ถูกลงบันทึกประจำวันแล้วว่าสูญหาย <br />การครอบครองหรือนำไปใช้งานต่อ<br />จะถือว่าไม่ชอบด้วยระเบียบของนิติบุคคล <br /> หากพบเห็นกรุณานำส่งสำนักงานนิติบุคคลทันที","label-no":"สติกเกอร์หมายเลข : ","date-lost":"วันที่แจ้งหาย : "},message:{"data-operate":{ing:"<h1>... กำลังค้นหา ...<\/h1>",access:"<h1>... กำลังเข้าถึงข้อมูล ...<\/h1>",error:"... เกิดข้อผิดพลาดในการดึงข้อมูล ...","not-allow":"... ไม่อนุญาติให้เข้าถึง/รหัสผืดพลาด ...",regist:"...กำลังบันทึกรายการ โปรดรอ...","regist-inc":"...บันทึกรายการไม่สำเร็จ โปรดลองอีกครั้ง...","regist-cmp":"...ลงทะเบียนสำเร็จ..."},lost:"สติกเกอร์นี้ถูกลงบันทึกประจำวันแล้วว่าสูญหาย <br />การครอบครองหรือนำไปใช้งานต่อ<br />จะถือว่าไม่ชอบด้วยระเบียบของนิติบุคคล <br /> หากพบเห็นกรุณานำส่งสำนักงานนิติบุคคลทันที","not-found":"ไม่พบข้อมูลจากรหัสคิวอาร์โค้ดนี้<br />กรุณาตรวจสอบใหม่อีกครั้ง",password:"โปรดระบุรหัสผ่าน"},"option-value":{"vehicle-type":{CAR:"รถยนต์",BIKE:"จักรยานยนต์"},"owner-zone":{BLD_A:"อาคาร A",BLD_B:"อาคาร B",BLD_C:"อาคาร C"}}}};var t="th-TH",i="",r="";return u=new w(f),c.prototype={constructor:c,component:{body:"body",container:"div#container",switchLanguage:{self:"label.sw-lang",input:"input#lang-toggle",knob:".sw-lang-knob .abbr"},infoArea00:"#info-area00",infoArea01:"#info-area01",infoArea02:"#info-area02",infoLost:"#info-lost",infoNotFound:"#info-notfound",caution:".caution",form:{self:"#frm-regist",label_no:"input#label-no",permit_qr:"input.permit-qr",vehicle_type:"select#vehicle-type",owner_unit:"input#owner-unit",owner_zone:"select#owner-zone",owner_name:"input#owner-name",owner_phone:"input#owner-phone",lp_province01:"select#lp-province-0",lp_no01:"input#lp-no-0",submit:"button"}},init:function(){let n=this,t=n.component;const i=function(n){let t=document;return n.forEach(function(r,u){if(r.isFunction())return 0;if(r.isObject())return n[u]=i(r),0;n[u]=t.querySelector(r);u=="self"&&(t=n[u])}),n},u=function(i){let r=localStorage.getItem(f+s);return i.input.addEventListener("change",function(n){let r=n.target.checked;t.body.classList.forEach(n=>{n.startsWith("lang-")?t.body.classList.remove(n):""});r&&(()=>{t.body.classList.add("lang-en"),i.input.checked=!0,i.input.setAttribute("aria-checked","true"),i.input.setAttribute("aria-label","Switch to Thai"),i.knob.textContent="EN"})();r||(()=>{t.body.classList.add("lang-th"),i.input.checked=!1,i.input.setAttribute("aria-checked","false"),i.input.setAttribute("aria-label","Switch to English"),i.knob.textContent="TH"})();localStorage.setItem(f+s,r?"en-EN":"th-TH");i.self.dispatchEvent(new Event("toggle"))}),i.input.checked=r=="en-EN",i.input.dispatchEvent(new Event("change")),i.self.addEventListener("toggle",function(){n.switch_language(localStorage.getItem(f+s))}),n.switch_language(r),i.self};return i(n.component),u(n.component.switchLanguage),t.body.addEventListener("onFetchData",function(t){n.render_info(t.data)}),r=new URLSearchParams(window.location.search).get(v),this},render:function(){return this},reset:function(){let n=this;return{resetAll:function(){let t=u.get(e);t?n.fetch_data.private.call(n):n.fetch_data.public.call(n)}}},switch_language:function(i){t=i?i:t;let r=undefined,u=document.querySelectorAll("[data-lang]");u.forEach(i=>{r=n[t];let f=i.getAttribute("data-lang");f=f.split(".");let u="";f.forEach(function(n){if(n=="date")return value=i.getAttribute("data-value"),u=new Date(value).toLocaleDateString(t,a),0;if(!r[n])return 0;if(r[n].isObject())return r=r[n],0;u=r[n]});u!=""&&(i.innerHTML=u)})},display_error:function(n="",t=""){let i=this.component;return n!=""&&function(){i.infoArea00.innerHTML=n==""?"":`<div class="error" data-lang="${t}">${n}</div>`;i.container.classList.remove("loader");i.container.classList.add("error")}(),n==""&&function(){i.infoArea00.innerHTML="";i.container.classList.remove("error")}(),this.switch_language(),i},display_notfound:function(){let t=this,n=t.component;this.display_error("");n.container.classList.add("not-found");n.container.classList.remove("loader");n.container.classList.add("ready");this.switch_language()},display_lost:function(n){let r=this,i=r.component;i.infoLost.innerHTML+=``;i.infoLost.innerHTML=i.infoLost.innerHTML+`
                <br><span data-lang="lost.label-no">สติกเกอร์หมายเลข</span>${n["label-no"]}
                <br><span data-lang="lost.date-lost">วันที่แจ้งหาย</span>${new Date(n["datetime-update"]).toLocaleDateString(t,p)}`;r.display_error();i.container.classList.add("lost");i.container.classList.remove("loader");i.container.classList.add("ready");this.switch_language()},render_info:function(i,r=false){function u(n="",i="",r="",u="",f="",e="",o=undefined){if(i.toString().trim()=="")return"";let s=i;if(o=="a"&&(s=`<a href="tel:${i.replace(/\D/g,"")}">${i}</a>`),o=="date")s=`<span data-lang="date" data-value="${i}">${new Date(i).toLocaleDateString(t,a)}</span>`;return`
                    <div class="item ${f}">
                        <div class="label" data-lang = "${r}">${n}</div>
                        <div class="value ${e}" data-lang = "${u}">${s}</div>
                    </div>`}let e=this,f=e.component;f.form.self.style.display="none";f.caution.style.display="none";f.infoArea01.innerHTML=`
                <h1 data-lang="header01">ข้อมูลผู้ใช้สิทธิ์จอดยานพาหนะ</h1>
                ${u("รหัสคิวอาร์",i["permit-qr"],"permit-qr")}
                ${u("ลำดับสติกเกอร์",i["label-no"],"label-no")}

                ${i.vehicles.length&&u("ประเภท",n.get_text("option-value.vehicle-type."+i["vehicle-type"]),"label-type","option-value.vehicle-type."+i["vehicle-type"])}

                ${u("อาคาร/โซนจอดฯ",n[t]["option-value"]["owner-zone"][i["owner-zone"]],"owner-zone")}

                ${u("เลขที่ห้องชุด",i["owner-unit"],"owner-unit")}
                ${u("ชื่อเจ้าของร่วมฯ",i["owner-name"],"owner-name")}
                ${u("หมายเลขโทรศัพท์",i["owner-phone"],"owner-phone","","","phone","a")}

                ${i["is-regist"]&&u("วันลงทะเบียน",i["datetime-regist"],"datetime-regist","","","","date")}
                ${i["is-regist"]&&u("วันหมดอายุ",i["date-expire"],"date-expire","","","expired","date")}

                ${u("หมายเหตุ",i.remark,"remark")}

                ${r?"":`<button id="btn-detail" data-lang="btn-detail">รายละเอียดผู้ใช้สิทธิ์ฯเพิ่มเติม</button>`}
            `;f.infoArea02.innerHTML="";var o="";i.vehicles.length||(f.infoArea02.innerHTML='<h2 data-lang="vehicle-notfound">ไม่พบข้อมูลยานพาหนะที่ลงทะเบียน<\/h2>');i.vehicles.forEach(function(t,i){o+=`
                    <h2 data-lang = "header-vehicle0${i+1}">ยานพาหนะ #${i+1}</h2>
                    ${u("ประเภท",n.get_text("option-value.vehicle-type."+t["vehicle-type"]),"vehicle-type","option-value.vehicle-type."+t["vehicle-type"],"vehicle-type-"+(t["vehicle-type"]=="BIKE"?"bike":"car")+(i+1))}
                    ${u("เลขทะเบียน",t["lp-no"],"lp-no")}
                    ${u("จังหวัดจดทะเบียน",t["lp-province"],"lp-province")}
                `});f.infoArea02.innerHTML=o;r||document.querySelector("button#btn-detail").addEventListener("click",function(){e.fetch_data.private.call(e)});f.caution.style.display="block";this.display_error()},render_form:function(t){let e=this,u=e.component;u.infoArea00.innerHTML="";u.infoArea01.innerHTML="";u.infoArea02.innerHTML="";var i=u.form;i.vehicle_type.addEventListener("change",function(){let t=this.value,n=u.form.self;n.classList.remove("vehicle-type-");n.classList.remove("vehicle-type-car");n.classList.remove("vehicle-type-bike");n.classList.add("vehicle-type-"+t.toLowerCase())});i.self.addEventListener("submit",async function(t){t.preventDefault();e.display_error(n.get_text("message.data-operate.regist"),"message.data-operate.regist");u.form.label_no.disabled=!1;u.form.vehicle_type.disabled=!1;const r=t.target,f=new FormData(r);let i=f.entries();for(let[n,t]of i){const r=n.match(/^vehicles\[(\d+)\]\[(.+)\]$/);if(r){const n=parseInt(r[1],10),u=r[2];i.vehicles||(i.vehicles=[]);i.vehicles[n]||(i.vehicles[n]={});i.vehicles[n][u]=t}else i[n]=t}e.fetch_data.regist.call(e,i)});i.label_no.value=t["label-no"]||"";i.vehicle_type.value=t["vehicle-type"]||"";i.vehicle_type.dispatchEvent(new Event("change"));i.permit_qr.value=r;i.owner_unit.value=t["owner-unit"]||"";i.owner_name.value=t["owner-name"]||"";i.owner_phone.value=t["owner-phone"]||"";i.vehicle_type.required=!0;i.label_no.required=!0;let f=t["label-no"]!=""&&t["vehicle-type"]!="";i.label_no.disabled=f;i.vehicle_type.disabled=f;i.lp_no01.required=f;i.lp_province01.required=f;i.owner_unit.required=f;i.owner_name.required=f;i.owner_phone.required=f;i.self.style.display="block";u.container.classList.remove("loader");u.container.classList.add("ready")},fetch_data:{ipaddr:async function(){const n=new AbortController,t=setTimeout(()=>n.abort(),h);try{const r=await fetch("https://api.ipify.org?format=json",{signal:n.signal});clearTimeout(t);const i=await r.json();return i.ip?i.ip:undefined}catch(i){return clearTimeout(t),""}},public:async function(){let t=this,u=t.component;if(u.container.classList.contains("loader"))return 0;u.container.classList.remove("lost");t.display_error(n.get_text("message.data-operate.ing"),"message.data-operate.ing");u.infoArea01.innerHTML="";u.infoArea02.innerHTML="";u.container.classList.add("loader");window.scrollTo({top:0,behavior:"smooth"});i=await t.fetch_data.ipaddr.call(t);const f=new AbortController,e=setTimeout(()=>f.abort(),h);try{const h=await fetch(`${o}`,{signal:f.signal,method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({"user-agent":navigator.userAgent,"ip-addr":i,"opt-direct":l,action:"permit-public","permit-qr":r})});if(clearTimeout(e),!h.ok)throw new Error(`HTTP ${h.status}`);t.display_error();const s=await h.json();if(!s){t.display_error(n.get_text("message.data-operate.error"),"message.data-operate.error");return}if(s&&s.status=="fail"){t.display_notfound();return}if(s&&s.status==""){t.display_notfound();return}if(!s.data){t.display_notfound();return}if(s.data["is-lost"])return t.display_lost(s.data),0;if(!s.data["is-regist"])return t.render_form(s.data),0;t.render_info(s.data);u.container.classList.remove("loader");u.container.classList.add("ready")}catch(s){clearTimeout(e);console.log(s.message);t.display_error(n.get_text("message.data-operate.error"),"message.data-operate.error");u.container.classList.remove("loader")}},private:async function(){let t=this,s=t.component,f=u.get(e);if(s.container.classList.contains("loader")||(f=f?f:prompt(n.get_text("message.password")),f==""||!f))return 0;window.scrollTo({top:0,behavior:"smooth"});s.infoArea01.innerHTML==""?t.display_error(n.get_text("message.data-operate.ing"),"message.data-operate.ing"):t.display_error(n.get_text("message.data-operate.access"),"message.data-operate.access");s.container.classList.add("loader");i=await t.fetch_data.ipaddr.call(t);const c=new AbortController,a=setTimeout(()=>c.abort(),h);try{const v=await fetch(`${o}`,{signal:c.signal,method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({"user-agent":navigator.userAgent,"ip-addr":i,"opt-direct":l,action:"permit-private","permit-qr":r,"user-key":f})});if(clearTimeout(a),!v.ok)throw new Error(`HTTP ${v.status}`);t.display_error();const h=await v.json();if(!h){t.display_error(n.get_text("message.data-operate.error"),"message.data-operate.error");return}if(h&&h.status=="fail"){t.display_error(n.get_text("message.data-operate.not-allow"),"message.data-operate.not-allow");return}if(!h.data){t.display_notfound();return}if(!h.data["is-regist"])return t.render_form(h.data),0;if(h.data["is-lost"])return t.display_lost(h.data),0;t.render_info(h.data,!0);u.get(e)||u.set(e,f,y);s.container.classList.remove("loader");s.container.classList.add("ready")}catch(v){clearTimeout(a);console.log(v.message);this.display_error(n.get_text("message.data-operate.error"));s.container.classList.remove("loader")}},regist:async function(t){let u=this,f=u.component;try{u.display_error(n.get_text("message.data-operate.regist"),"message.data-operate.regist");f.container.classList.add("loader");window.scrollTo({top:0,behavior:"smooth"});t.action="permit-regist";t["ip-addr"]=i;t["user-agent"]=navigator.userAgent;t["permit-qr"]=r;const s=await fetch(`${o}`,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(t)}),e=await s.json();if(e&&e.status=="fail"&&u.display_error(n.get_text("message.data-operate.regist-inc"),"message.data-operate.regist-inc"),e&&e.status=="not-found"){u.display_error(`...${e.message}...`);return}if(e&&e.status=="conflict"){u.display_error(`...${e.message}...`);return}u.display_error(n.get_text("message.data-operate.regist-cmp"),"message.data-operate.regist-cmp");u.render_info(e.data,!0);f.container.classList.remove("loader")}catch(e){console.log(e.message);f.container.classList.remove("loader");u.display_error(n.get_text("message.data-operate.regist-inc"),"message.data-operate.regist-inc")}}}},c})());NS("App.Module",INSTANCE,new(NS(NAMESPACE,NAMECLASS)));